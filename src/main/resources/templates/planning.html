<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
    <head th:replace="index :: head">></head>
    <body>
        <header th:replace="index :: header"></header>

        <!-- planning content start -->
        <div class="container" style="background-color: rgb(255,255,255);">
            <div class="row">
                <div class="col-lg-8">
                    <div th:if="${viewMode.equals('time')}" th:fragment="stint-table" class="table-responsive">
                        <table class="table table-striped">
                            <thead style="vertical-align: middle;">
                            <tr class="text-center">
                                <th>Stint</th>
                                <th>Driver</th>
                                <th>Start local</th>
                                <th>Start ToD</th>
                                <th>Laps</th>
                                <th>Duration</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="stint, stintStat: ${selectedPlan.getStints()}">
                                <td th:text="${stintStat.index}">1</td>
                                <td>
                                    <select>
                                        <option th:each="driver, driverStat : ${selectedPlan.getAvailableDrivers(stint.getEndTime())}" th:value="${stint}" th:text="${driver.getName()}" th:selected="${stint.getDriverName().equals(driver.getName())}">Dave</option>
                                    </select>
                                </td>
                                <td th:text="${stint.getStartTimeString()}">00:04:53</td>
                                <td th:text="${stint.getTodStartTimeString()}">09:34:53</td>
                                <td th:text="${stint.getLaps()}">7</td>
                                <td th:text="${stint.getStintDurationString(true)}">01:04:28</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>


                    <div th:if="${viewMode.equals('schedule')}" th:fragment="schedule-table" class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                            <tr>
                                <th>Stint</th>
                                <th>Start Local</th>
                                <th>Start ToD</th>
                                <th th:each="driver : ${selectedPlan.getAllDrivers()}" th:text="${driver.getName()}">Dave</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="stint, stintStat: ${selectedPlan.getStints()}">
                                <td th:text="${stintStat.index}">1</td>
                                <td th:text="${stint.getStartTimeString()}">00:04:53</td>
                                <td th:text="${stint.getTodStartTimeString()}">09:34:53</td>
                                <td th:each="driver : ${selectedPlan.getAllDrivers()}"
                                    th:text="${selectedPlan.getDriverStatusAt(driver.getId(), stint.getEndTime()).name()}"
                                    th:class="${selectedPlan.getDriverStatusAt(driver.getId(), stint.getEndTime()).cssClassName()}">
<!--                                    <select  class="bg-success" th:id="${stintStat.index + '-' + driver}" th:onchange="'this.className = this.value'">-->
<!--                                        <option class="bg-success" value="bg-success" selected="">Open</option>-->
<!--                                        <option class="bg-warning" value="bg-warning">Tentative</option>-->
<!--                                        <option class="bg-danger" value="bg-danger">Blocked</option>-->
<!--                                    </select>-->
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>


                </div>


                <div class="col-lg-4">
                    <form method="post" th:action="@{/planning(viewMode=${viewMode})}" th:object="${selectedPlan}">
                        <div class="form-row">
                            <div class="col">
                                <ul class="nav nav-tabs border rounded shadow">
                                    <li class="nav-item border rounded"><a class="nav-link active bg-warning" th:href="@{/planning(viewMode='time', planId=*{id})}">Times</a></li>
                                    <li class="nav-item border rounded"><a class="nav-link bg-info" th:href="@{/planning(viewMode='schedule', planId=*{id})}">Schedule</a></li>
                                </ul>
                                <input class="form-control" type="text" th:field="*{name}" placeholder="New race plan">
                                <input th:field="*{id}" type="hidden">
                            </div>
                        </div>
                        <div th:if="${viewMode.equals('time')}">
                            <div class="form-row">
                                <div class="col">
                                    <div class="form-group">
                                        <select th:field="*{trackId}" class="form-control" name="track" required="">
                                            <option th:each="track : ${tracks}" th:value="${track.id}" th:text="${track.name}">NÃ¼rburgring Combined 24</option>
                                        </select>
                                        <select th:field="*{teamId}" class="form-control" name="team" readonly="" style="margin-top: 5px;">
                                            <option th:each="team : ${teams}" th:value="${team.id}" th:text="${team.name}">FBP Racing RED</option>
                                        </select>
                                        <select th:field="*{carId}" class="form-control" name="car">
                                            <option th:each="car : ${cars}" th:value="${car.id}" th:text="${car.name}" selected="">BMW Z4 GT3</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="col">
                                    <div class="form-group"><label>Race start date</label>
                                        <input th:field="*{sessionStartDate}" class="form-control" type="date" required="">
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="form-group"><label>Time (Local)</label>
                                        <input th:field="*{startLocalTime}" class="form-control" type="time" required="">
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="col">
                                    <div class="form-group"><label>Race start date (Sim)</label>
                                        <input th:field="*{todStartDate}" class="form-control" type="date" name="raceStartTod" required="">
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="form-group"><label>Time (ToD)</label>
                                        <input th:field="*{startTodTime}" class="form-control" type="time" required="">
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="col">
                                    <div class="form-group"><label>Race duration</label>
                                        <input th:field="*{raceDuration}" class="form-control" type="text" name="raceDuration" placeholder="00:00:00" required="" pattern="^(?:(?:([0-9]?\d|2[0-9]):)?([0-5]?\d)$">
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="form-group"><label>Green flag offset</label>
                                        <input th:field="*{greenFlagOffsetTime}" class="form-control" type="text" placeholder="00:00:00" required="" pattern="^(?:(?:([01]?\d|2[0-3]):)?([0-5]?\d):)?([0-5]?\d)$">
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="col">
                                    <div class="form-group"><label>Nominal lap time</label>
                                        <input th:field="*{avgLapTime}" class="form-control" type="text" name="avgLapTime" placeholder="00:00:00" required="" pattern="^(?:(?:([01]?\d|2[0-3]):)?([0-5]?\d):)?([0-5]?\d)$">
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="form-group"><label>Pitstop duration</label>
                                        <input th:field="*{avgPitStopTime}" class="form-control" type="text" name="avgPitTime" placeholder="00:00:00" required="" pattern="^(?:(?:([01]?\d|2[0-3]):)?([0-5]?\d):)?([0-5]?\d)$">
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="col">
                                    <div class="form-group"><label>Max. fuel</label>
                                        <input th:field="*{maxCarFuel}" class="form-control" type="text" name="maxFuel" placeholder="115,5" required="">
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="form-group"><label>Avg. fuel per lap</label>
                                        <input th:field="*{avgFuelPerLap}" class="form-control" type="text" name="avgFuelPerLap" placeholder="9,84" required="">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div th:if="${viewMode.equals('schedule')}">
                            <input th:field="*{maxCarFuel}" type="hidden">
                            <input th:field="*{avgFuelPerLap}" type="hidden">
                            <input th:field="*{sessionStartTime}" type="hidden">
                            <input th:field="*{todStartTime}" type="hidden">
                            <input th:field="*{avgLapTime}" type="hidden">
<!--                            <div class="form-row">-->
<!--                                <div class="col">-->
<!--                                    <div class="form-group"><label>Driver count</label>-->
<!--                                        <input class="form-control" type="number" name="driverCount" value="3"></div>-->
<!--                                </div>-->
<!--                            </div>-->
                            <div class="form-row">
                                <div class="col">
                                    <div class="form-group">
                                        <select th:field="*{allDriverIds}" class="form-control" multiple style="height: 10em;">
                                            <option th:each="driver : ${authorizedDrivers}" th:value="${driver.getId()}" th:text="${driver.getName()}" selected="*{allDrivers.contains(driver)}">Dave</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div th:each="driver, driverStat : *{allDrivers}">
                                <div class="form-row" th:each="scheduleEntry : ${selectedPlan.getDriverSchedule(driver.getId())}">
                                    <div class="col">
                                        <div class="form-group"><label th:text="${driver.getName() + ' schedule from'}">Nominal lap time</label>
                                            <input class="form-control" type="time" th:value="${scheduleEntry.fromTime}">
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="form-group"><label>Availability</label>
                                            <select class="form-control" th:value="${scheduleEntry.status.cssClassName()}" type="select" th:class="${scheduleEntry.status.cssClassName()}" th:onchange="'this.className = this.value'">
                                                <option value="bg-success" class="bg-success">OPEN</option>
                                                <option value="bg-warning" class="bg-warning">TENTATIVE</option>
                                                <option value="bg-danger" class="bg-danger">BLOCKED</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-row" th:each="estimation : ${selectedPlan.getDriverEstimations(driver.getId())}">
                                    <div class="col">
                                        <div class="form-group"><label th:text="${driver.getName() + ' estimation from'}"></label>
                                            <input class="form-control" type="time" th:value="${estimation.todTime}">
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="form-group"><label>Avg. lap time</label>
                                            <input class="form-control" type="text" th:value="${estimation.avgLapTime}">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group text-center">
                            <button class="btn btn-primary btn-block" type="submit">Save</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <script src="assets/js/bs-init.js"></script>
        <!-- End: Team content -->

        <div th:insert="index :: footer"></div>
    </body>
</html>
